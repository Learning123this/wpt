<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Test Metadata &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="commands.json" href="commands.html" />
    <link rel="prev" title="wptrunner: A web-platform-tests harness" href="../README.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="test-metadata">
<h1>Test Metadata<a class="headerlink" href="#test-metadata" title="Link to this heading">¶</a></h1>
<section id="directory-layout">
<h2>Directory Layout<a class="headerlink" href="#directory-layout" title="Link to this heading">¶</a></h2>
<p>Metadata files must be stored under the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> directory passed
to the test runner. The directory layout follows that of
web-platform-tests with each test source path having a corresponding
metadata file. Because the metadata path is based on the source file
path, files that generate multiple URLs e.g. tests with multiple
variants, or multi-global tests generated from an <code class="docutils literal notranslate"><span class="pre">any.js</span></code> input
file, share the same metadata file for all their corresponding
tests. The metadata path under the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> directory is the same
as the source path under the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory, with an additional
<code class="docutils literal notranslate"><span class="pre">.ini</span></code> suffix.</p>
<p>For example a test with URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/spec/section/file.html?query=param
</pre></div>
</div>
<p>generated from a source file with path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tests</span> <span class="n">root</span><span class="o">&gt;/</span><span class="n">spec</span><span class="o">/</span><span class="n">section</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>would have a metadata file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">metadata</span> <span class="n">root</span><span class="o">&gt;/</span><span class="n">spec</span><span class="o">/</span><span class="n">section</span><span class="o">/</span><span class="n">file</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>As an optimisation, files which produce only default results
(i.e. <code class="docutils literal notranslate"><span class="pre">PASS</span></code> or <code class="docutils literal notranslate"><span class="pre">OK</span></code>), and which don’t have any other associated
metadata, don’t require a corresponding metadata file.</p>
<section id="directory-metadata">
<h3>Directory Metadata<a class="headerlink" href="#directory-metadata" title="Link to this heading">¶</a></h3>
<p>In addition to per-test metadata, default metadata can be applied to
all the tests in a given source location, using a <code class="docutils literal notranslate"><span class="pre">__dir__.ini</span></code>
metadata file. For example to apply metadata to all tests under
<code class="docutils literal notranslate"><span class="pre">&lt;tests</span> <span class="pre">root&gt;/spec/</span></code> add the metadata in <code class="docutils literal notranslate"><span class="pre">&lt;tests</span>
<span class="pre">root&gt;/spec/__dir__.ini</span></code>.</p>
</section>
</section>
<section id="metadata-format">
<h2>Metadata Format<a class="headerlink" href="#metadata-format" title="Link to this heading">¶</a></h2>
<p>The format of the metadata files is based on the ini format. Files are
divided into sections, each (apart from the root section) having a
heading enclosed in square braces. Within each section are key-value
pairs. There are several notable differences from standard .ini files,
however:</p>
<blockquote>
<div><ul class="simple">
<li><p>Sections may be hierarchically nested, with significant whitespace
indicating nesting depth.</p></li>
<li><p>Only <code class="docutils literal notranslate"><span class="pre">:</span></code> is valid as a key/value separator</p></li>
</ul>
</div></blockquote>
<p>A simple example of a metadata file is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root_key</span><span class="p">:</span> <span class="n">root_value</span>

<span class="p">[</span><span class="n">section</span><span class="p">]</span>
  <span class="n">section_key</span><span class="p">:</span> <span class="n">section_value</span>

  <span class="p">[</span><span class="n">subsection</span><span class="p">]</span>
     <span class="n">subsection_key</span><span class="p">:</span> <span class="n">subsection_value</span>

<span class="p">[</span><span class="n">another_section</span><span class="p">]</span>
  <span class="n">another_key</span><span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>
</pre></div>
</div>
<section id="conditional-values">
<h3>Conditional Values<a class="headerlink" href="#conditional-values" title="Link to this heading">¶</a></h3>
<p>In order to support values that depend on some external data, the
right hand side of a key/value pair can take a set of conditionals
rather than a plain value. These values are placed on a new line
following the key, with significant indentation. Conditional values
are prefixed with <code class="docutils literal notranslate"><span class="pre">if</span></code> and terminated with a colon, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">cond1</span><span class="p">:</span> <span class="n">value1</span>
  <span class="k">if</span> <span class="n">cond2</span><span class="p">:</span> <span class="n">value2</span>
  <span class="n">value3</span>
</pre></div>
</div>
<p>In this example, the value associated with <code class="docutils literal notranslate"><span class="pre">key</span></code> is determined by
first evaluating <code class="docutils literal notranslate"><span class="pre">cond1</span></code> against external data. If that is true,
<code class="docutils literal notranslate"><span class="pre">key</span></code> is assigned the value <code class="docutils literal notranslate"><span class="pre">value1</span></code>, otherwise <code class="docutils literal notranslate"><span class="pre">cond2</span></code> is
evaluated in the same way. If both <code class="docutils literal notranslate"><span class="pre">cond1</span></code> and <code class="docutils literal notranslate"><span class="pre">cond2</span></code> are false,
the unconditional <code class="docutils literal notranslate"><span class="pre">value3</span></code> is used.</p>
<p>Conditions themselves use a Python-like expression syntax. Operands
can either be variables, corresponding to data passed in, numbers
(integer or floating point; exponential notation is not supported) or
quote-delimited strings. Equality is tested using <code class="docutils literal notranslate"><span class="pre">==</span></code> and
inequality by <code class="docutils literal notranslate"><span class="pre">!=</span></code>. The operators <code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span></code> are
used in the expected way. Parentheses can also be used for
grouping. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span><span class="p">:</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="s2">&quot;abc&quot;</span><span class="p">:</span> <span class="n">value1</span>
  <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">!=</span> <span class="s2">&quot;abc&quot;</span><span class="p">:</span> <span class="n">value2</span>
  <span class="n">value3</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are variables, the value of which will be
supplied when the metadata is used.</p>
</section>
</section>
<section id="web-platform-tests-metadata">
<h2>Web-Platform-Tests Metadata<a class="headerlink" href="#web-platform-tests-metadata" title="Link to this heading">¶</a></h2>
<p>When used for expectation data, metadata files have the following format:</p>
<blockquote>
<div><ul>
<li><p>A section per test URL provided by the corresponding source file,
with the section heading being the part of the test URL following
the last <code class="docutils literal notranslate"><span class="pre">/</span></code> in the path (this allows multiple tests in a single
metadata file with the same path part of the URL, but different
query parts). This may be omitted if there’s no non-default
metadata for the test.</p></li>
<li><p>A subsection per subtest, with the heading being the title of the
subtest. This may be omitted if there’s no non-default metadata for
the subtest.</p></li>
<li><p>The following known keys:</p>
<dl class="field-list simple">
<dt class="field-odd">expected<span class="colon">:</span></dt>
<dd class="field-odd"><p>The expectation value or values of each (sub)test. In
the case this value is a list, the first value represents the
typical expected test outcome, and subsequent values indicate
known intermittent outcomes e.g. <code class="docutils literal notranslate"><span class="pre">expected:</span> <span class="pre">[PASS,</span> <span class="pre">ERROR]</span></code>
would indicate a test that usually passes but has a known-flaky
<code class="docutils literal notranslate"><span class="pre">ERROR</span></code> outcome.</p>
</dd>
<dt class="field-even">disabled<span class="colon">:</span></dt>
<dd class="field-even"><p>Any values apart from the special value <code class="docutils literal notranslate"><span class="pre">&#64;False</span></code>
indicates that the (sub)test is disabled and should either not be
run (for tests) or that its results should be ignored (subtests).</p>
</dd>
<dt class="field-odd">restart-after<span class="colon">:</span></dt>
<dd class="field-odd"><p>Any value apart from the special value <code class="docutils literal notranslate"><span class="pre">&#64;False</span></code>
indicates that the runner should restart the browser after running
this test (e.g. to clear out unwanted state).</p>
</dd>
<dt class="field-even">fuzzy<span class="colon">:</span></dt>
<dd class="field-even"><p>Used for reftests. This is interpreted as a list containing
entries like <code class="docutils literal notranslate"><span class="pre">&lt;meta</span> <span class="pre">name=fuzzy&gt;</span></code> content value, which consists of
an optional reference identifier followed by a colon, then a range
indicating the maximum permitted pixel difference per channel, then
semicolon, then a range indicating the maximum permitted total
number of differing pixels. The reference identifier is either a
single relative URL, resolved against the base test URL, in which
case the fuzziness applies to any comparison with that URL, or
takes the form lhs URL, comparison, rhs URL, in which case the
fuzziness only applies for any comparison involving that specific
pair of URLs. Some illustrative examples are given below.</p>
</dd>
<dt class="field-odd">implementation-status<span class="colon">:</span></dt>
<dd class="field-odd"><p>One of the values <code class="docutils literal notranslate"><span class="pre">implementing</span></code>,
<code class="docutils literal notranslate"><span class="pre">not-implementing</span></code> or <code class="docutils literal notranslate"><span class="pre">backlog</span></code>. This is used in conjunction
with the <code class="docutils literal notranslate"><span class="pre">--skip-implementation-status</span></code> command line argument to
<code class="docutils literal notranslate"><span class="pre">wptrunner</span></code> to ignore certain features where running the test is
low value.</p>
</dd>
<dt class="field-even">tags<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of labels associated with a given test that can be
used in conjunction with the <code class="docutils literal notranslate"><span class="pre">--tag</span></code> command line argument to
<code class="docutils literal notranslate"><span class="pre">wptrunner</span></code> for test selection.</p>
</dd>
</dl>
<p>In addition there are extra arguments which are currently tied to
specific implementations. For example Gecko-based browsers support
<code class="docutils literal notranslate"><span class="pre">min-asserts</span></code>, <code class="docutils literal notranslate"><span class="pre">max-asserts</span></code>, <code class="docutils literal notranslate"><span class="pre">prefs</span></code>, <code class="docutils literal notranslate"><span class="pre">lsan-disabled</span></code>,
<code class="docutils literal notranslate"><span class="pre">lsan-allowed</span></code>, <code class="docutils literal notranslate"><span class="pre">lsan-max-stack-depth</span></code>, <code class="docutils literal notranslate"><span class="pre">leak-allowed</span></code>, and
<code class="docutils literal notranslate"><span class="pre">leak-threshold</span></code> properties.</p>
</li>
<li><p>Variables taken from the <code class="docutils literal notranslate"><span class="pre">RunInfo</span></code> data which describe the
configuration of the test run. Common properties include:</p>
<dl class="field-list simple">
<dt class="field-odd">product<span class="colon">:</span></dt>
<dd class="field-odd"><p>A string giving the name of the browser under test</p>
</dd>
<dt class="field-even">browser_channel<span class="colon">:</span></dt>
<dd class="field-even"><p>A string giving the release channel of the browser under test</p>
</dd>
<dt class="field-odd">debug<span class="colon">:</span></dt>
<dd class="field-odd"><p>A Boolean indicating whether the build is a debug build</p>
</dd>
<dt class="field-even">os<span class="colon">:</span></dt>
<dd class="field-even"><p>A string  the operating system</p>
</dd>
<dt class="field-odd">version<span class="colon">:</span></dt>
<dd class="field-odd"><p>A string indicating the particular version of that operating system</p>
</dd>
<dt class="field-even">processor<span class="colon">:</span></dt>
<dd class="field-even"><p>A string indicating the processor architecture.</p>
</dd>
</dl>
<p>This information is typically provided by <a class="reference external" href="https://firefox-source-docs.mozilla.org/mozbase/mozinfo.html#module-mozinfo" title="(in Firefox Source Docs)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozinfo</span></code></a>, but
different environments may add additional information, and not all
the properties above are guaranteed to be present in all
environments. The definitive list of available properties for a
specific run may be determined by looking at the <code class="docutils literal notranslate"><span class="pre">run_info</span></code> key
in the <code class="docutils literal notranslate"><span class="pre">wptreport.json</span></code> output for the run.</p>
</li>
<li><p>Top level keys are taken as defaults for the whole file. So, for
example, a top level key with <code class="docutils literal notranslate"><span class="pre">expected:</span> <span class="pre">FAIL</span></code> would indicate
that all tests and subtests in the file are expected to fail,
unless they have an <code class="docutils literal notranslate"><span class="pre">expected</span></code> key of their own.</p></li>
</ul>
</div></blockquote>
<p>An simple example metadata file might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[test.html?variant=basic]
  type: testharness

  [Test something unsupported]
     expected: FAIL

  [Test with intermittent statuses]
     expected: [PASS, TIMEOUT]

[test.html?variant=broken]
  expected: ERROR

[test.html?variant=unstable]
  disabled: http://test.bugs.example.org/bugs/12345
</pre></div>
</div>
<p>A more complex metadata file with conditional properties might be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">canvas_test</span><span class="o">.</span><span class="n">html</span><span class="p">]</span>
  <span class="n">expected</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;mac&quot;</span><span class="p">:</span> <span class="n">FAIL</span>
    <span class="k">if</span> <span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;XP&quot;</span><span class="p">:</span> <span class="n">FAIL</span>
    <span class="n">PASS</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">PASS</span></code> in the above works, but is unnecessary since it’s
the default expected result.</p>
<p>A metadata file with fuzzy reftest values might be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">reftest</span><span class="o">.</span><span class="n">html</span><span class="p">]</span>
  <span class="n">fuzzy</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">;</span><span class="mi">200</span><span class="p">,</span> <span class="n">ref1</span><span class="o">.</span><span class="n">html</span><span class="p">:</span><span class="mi">20</span><span class="p">;</span><span class="mi">200</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="n">subtest1</span><span class="o">.</span><span class="n">html</span><span class="o">==</span><span class="n">ref2</span><span class="o">.</span><span class="n">html</span><span class="p">:</span><span class="mi">10</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<p>In this case the default fuzziness for any comparison would be to
require a maximum difference per channel of less than or equal to 10
and less than or equal to 200 total pixels different. For any
comparison involving ref1.html on the right hand side, the limits
would instead be a difference per channel not more than 20 and a total
difference count of not less than 200 and not more than 300. For the
specific comparison <code class="docutils literal notranslate"><span class="pre">subtest1.html</span> <span class="pre">==</span> <span class="pre">ref2.html</span></code> (both resolved against
the test URL) these limits would instead be 10 to 15 and 0 to 20,
respectively.</p>
</section>
<section id="generating-expectation-files">
<h2>Generating Expectation Files<a class="headerlink" href="#generating-expectation-files" title="Link to this heading">¶</a></h2>
<p>wpt provides the tool <code class="docutils literal notranslate"><span class="pre">wpt</span> <span class="pre">update-expectations</span></code> command to generate
expectation files from the results of a set of test runs. The basic
syntax for this is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">wpt</span> <span class="n">update</span><span class="o">-</span><span class="n">expectations</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="p">[</span><span class="n">logfile</span><span class="p">]</span><span class="o">...</span>
</pre></div>
</div>
<p>Each <code class="docutils literal notranslate"><span class="pre">logfile</span></code> is a wptreport log file from a previous run. These
can be generated from wptrunner using the <code class="docutils literal notranslate"><span class="pre">--log-wptreport</span></code> option
e.g. <code class="docutils literal notranslate"><span class="pre">--log-wptreport=wptreport.json</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">update-expectations</span></code> takes several options:</p>
<dl class="option-list">
<dt><kbd><span class="option">--full</span></kbd></dt>
<dd><p>Overwrite all the expectation data for any tests that have a
result in the passed log files, not just data for the same run
configuration.</p>
</dd>
<dt><kbd><span class="option">--disable-intermittent</span></kbd></dt>
<dd><p>When updating test results, disable tests that
have inconsistent results across many
runs. This can precede a message providing a
reason why that test is disable. If no message
is provided, <code class="docutils literal notranslate"><span class="pre">unstable</span></code> is the default text.</p>
</dd>
<dt><kbd><span class="option">--update-intermittent</span></kbd></dt>
<dd><p>When this option is used, the <code class="docutils literal notranslate"><span class="pre">expected</span></code> key
stores expected intermittent statuses in
addition to the primary expected status. If
there is more than one status, it appears as a
list. The default behaviour of this option is to
retain any existing intermittent statuses in the
list unless <code class="docutils literal notranslate"><span class="pre">--remove-intermittent</span></code> is
specified.</p>
</dd>
<dt><kbd><span class="option">--remove-intermittent</span></kbd></dt>
<dd><p>This option is used in conjunction with
<code class="docutils literal notranslate"><span class="pre">--update-intermittent</span></code>.  When the
<code class="docutils literal notranslate"><span class="pre">expected</span></code> statuses are updated, any obsolete
intermittent statuses that did not occur in the
specified log files are removed from the list.</p>
</dd>
</dl>
<section id="property-configuration">
<h3>Property Configuration<a class="headerlink" href="#property-configuration" title="Link to this heading">¶</a></h3>
<p>In cases where the expectation depends on the run configuration <code class="docutils literal notranslate"><span class="pre">wpt</span>
<span class="pre">update-expectations</span></code> is able to generate conditional values. Because
the relevant variables depend on the range of configurations that need
to be covered, it’s necessary to specify the list of configuration
variables that should be used. This is done using a <code class="docutils literal notranslate"><span class="pre">json</span></code> format
file that can be specified with the <code class="docutils literal notranslate"><span class="pre">--properties-file</span></code> command line
argument to <code class="docutils literal notranslate"><span class="pre">wpt</span> <span class="pre">update-expectations</span></code>. When this isn’t supplied the
defaults from <code class="docutils literal notranslate"><span class="pre">&lt;metadata</span> <span class="pre">root&gt;/update_properties.json</span></code> are used, if
present.</p>
<section id="properties-file-format">
<h4>Properties File Format<a class="headerlink" href="#properties-file-format" title="Link to this heading">¶</a></h4>
<p>The file is JSON formatted with two top-level keys:</p>
<dl class="field-list simple">
<dt class="field-odd"><code class="docutils literal notranslate"><span class="pre">properties</span></code><span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of property names to consider for conditionals
e.g <code class="docutils literal notranslate"><span class="pre">[&quot;product&quot;,</span> <span class="pre">&quot;os&quot;]</span></code>.</p>
</dd>
<dt class="field-even"><code class="docutils literal notranslate"><span class="pre">dependents</span></code><span class="colon">:</span></dt>
<dd class="field-even"><p>An optional dictionary containing properties that
should only be used as “tie-breakers” when differentiating based on a
specific top-level property has failed. This is useful when the
dependent property is always more specific than the top-level
property, but less understandable when used directly. For example the
<code class="docutils literal notranslate"><span class="pre">version</span></code> property covering different OS versions is typically
unique amongst different operating systems, but using it when the
<code class="docutils literal notranslate"><span class="pre">os</span></code> property would do instead is likely to produce metadata that’s
too specific to the current configuration and more difficult to
read. But where there are multiple versions of the same operating
system with different results, it can be necessary. So specifying
<code class="docutils literal notranslate"><span class="pre">{&quot;os&quot;:</span> <span class="pre">[&quot;version&quot;]}</span></code> as a dependent property means that the
<code class="docutils literal notranslate"><span class="pre">version</span></code> property will only be used if the condition already
contains the <code class="docutils literal notranslate"><span class="pre">os</span></code> property and further conditions are required to
separate the observed results.</p>
</dd>
</dl>
<p>So an example <code class="docutils literal notranslate"><span class="pre">update-properties.json</span></code> file might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;os&quot;</span><span class="p">],</span>
  <span class="s2">&quot;dependents&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;browser_channel&quot;</span><span class="p">],</span> <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h3>
<p>Update all the expectations from a set of cross-platform test runs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wpt</span> <span class="n">update</span><span class="o">-</span><span class="n">expectations</span> <span class="o">--</span><span class="n">full</span> <span class="n">osx</span><span class="o">.</span><span class="n">log</span> <span class="n">linux</span><span class="o">.</span><span class="n">log</span> <span class="n">windows</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>Add expectation data for some new tests that are expected to be
platform-independent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wpt</span> <span class="n">update</span><span class="o">-</span><span class="n">expectations</span> <span class="n">tests</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</section>
</section>
<section id="why-a-custom-format">
<h2>Why a Custom Format?<a class="headerlink" href="#why-a-custom-format" title="Link to this heading">¶</a></h2>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>Given the use of the metadata files in CI systems, it was desirable to
have something with the following properties:</p>
<blockquote>
<div><ul class="simple">
<li><p>Human readable</p></li>
<li><p>Human editable</p></li>
<li><p>Machine readable / writable</p></li>
<li><p>Capable of storing key-value pairs</p></li>
<li><p>Suitable for storing in a version control system (i.e. text-based)</p></li>
</ul>
</div></blockquote>
<p>The need for different results per platform means either having
multiple expectation files for each platform, or having a way to
express conditional values within a certain file. The former would be
rather cumbersome for humans updating the expectation files, so the
latter approach has been adopted, leading to the requirement:</p>
<blockquote>
<div><ul class="simple">
<li><p>Capable of storing result values that are conditional on the platform.</p></li>
</ul>
</div></blockquote>
<p>There are few extant formats that clearly meet these requirements. In
particular although conditional properties could be expressed in many
existing formats, the representation would likely be cumbersome and
error-prone for hand authoring. Therefore it was decided that a custom
format offered the best tradeoffs given the requirements.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro-video-transcript.html">“Introduction to WPT” video transcript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../running-tests/index.html">Running Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writing-tests/index.html">Writing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../admin/index.html">Project Administration</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../admin/index.html#tooling">Tooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../admin/index.html#secrets">Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../admin/index.html#third-party-account-owners">Third-party account owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../admin/index.html#emergency-playbook">Emergency playbook</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../admin/index.html">Project Administration</a><ul>
  <li><a href="../README.html">wptrunner: A web-platform-tests harness</a><ul>
      <li>Previous: <a href="../README.html" title="previous chapter">wptrunner: A web-platform-tests harness</a></li>
      <li>Next: <a href="commands.html" title="next chapter">commands.json</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, wpt contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../_sources/tools/wptrunner/docs/expectation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
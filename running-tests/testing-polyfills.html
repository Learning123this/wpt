<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Testing polyfills &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="testing-polyfills">
<h1>Testing polyfills<a class="headerlink" href="#testing-polyfills" title="Link to this heading">¶</a></h1>
<section id="preparing-the-polyfill">
<h2>Preparing the polyfill<a class="headerlink" href="#preparing-the-polyfill" title="Link to this heading">¶</a></h2>
<p>The polyfill script-injection feature currently only supports scripts which
are immediately invoked. The script must be prepared as a single file whose
contents will be inlined into a script tag served as part of every test page.</p>
<p>If your polyfill is only available as an asynchronous module with dependent
scripts, you can use a tool such as
<a class="reference external" href="https://github.com/developit/microbundle">microbundle</a> to repackage it as a
single synchronous script file, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>microbundle<span class="w"> </span>-f<span class="w"> </span>iife<span class="w"> </span>-i<span class="w"> </span>polyfill/src/main.js<span class="w"> </span>-o<span class="w"> </span>polyfill.js
</pre></div>
</div>
</section>
<section id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="Link to this heading">¶</a></h2>
<p>Follow the steps for <a class="reference internal" href="from-local-system.html"><span class="doc">Running Tests from the Local System</span></a> to
set up your test environment. When running tests via the browser or via the
command line, add the <code class="docutils literal notranslate"><span class="pre">--inject-script=polyfill.js</span></code> to either command, e.g.</p>
<p>Via the browser:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./wpt<span class="w"> </span>serve<span class="w"> </span>--inject-script<span class="o">=</span>polyfill.js
</pre></div>
</div>
<p>Then visit http://web-platform.test:8000/ or https://web-platform.test:8443/ to
run the tests in your browser.</p>
<p>Via the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./wpt<span class="w"> </span>run<span class="w"> </span>--inject-script<span class="o">=</span>polyfill.js<span class="w"> </span><span class="o">[</span>browsername<span class="o">]</span><span class="w"> </span><span class="o">[</span>tests<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h2>
<p>Polyfill scripts are injected to an inline script tag which removes itself from
the DOM after executing. This is done by modifying the server response for
documents with a <code class="docutils literal notranslate"><span class="pre">text/html</span></code> MIME type  to insert the following before the first tag in
the served response:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c1">// &lt;-- The polyfill file is inlined here</span>
// Remove the injected script tag from the DOM.
document.currentScript.remove();
</pre></div>
</div>
<p>This approach has a couple limitations:</p>
<ul class="simple">
<li><p>This requires that the polyfill is self-contained and executes
synchronously in a single inline script. See <a class="reference external" href="#preparing-the-polyfill">Preparing the
polyfill</a> for suggestions on transforming polyfills to
run in that way.</p></li>
<li><p>Does not inject into python handlers which write directly to the output
stream.</p></li>
<li><p>Does not inject into the worker context of <code class="docutils literal notranslate"><span class="pre">.any.js</span></code> tests.</p></li>
</ul>
<section id="observability">
<h3>Observability<a class="headerlink" href="#observability" title="Link to this heading">¶</a></h3>
<p>The script tag is removed from the DOM before any other script has run, and runs
from an inline script. As such, it should not affect mutation observers on the
same page or resource timing APIs, as it is not a separate resource. The polyfill
may be observable by a mutation observer added by a parent frame before load.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro-video-transcript.html">“Introduction to WPT” video transcript</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Running Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-tests/index.html">Writing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Project Administration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, wpt contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/running-tests/testing-polyfills.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
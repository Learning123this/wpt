<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>IDL Tests (idlharness.js) &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="testharness.js tutorial" href="testharness-tutorial.html" />
    <link rel="prev" title="Testdriver extension tutorial" href="testdriver-extension-tutorial.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="idl-tests-idlharness-js">
<h1>IDL Tests (idlharness.js)<a class="headerlink" href="#idl-tests-idlharness-js" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">idlharness.js</span></code> generates tests for Web IDL fragments, using the
<a class="reference internal" href="testharness.html"><span class="doc">JavaScript Tests (testharness.js)</span></a> infrastructure. You typically want to use
<code class="docutils literal notranslate"><span class="pre">.any.js</span></code> or <code class="docutils literal notranslate"><span class="pre">.window.js</span></code> for this to avoid having to write unnessary boilerplate.</p>
</section>
<section id="adding-idl-fragments">
<h2>Adding IDL fragments<a class="headerlink" href="#adding-idl-fragments" title="Link to this heading">¶</a></h2>
<p>Web IDL is automatically scraped from specifications and added to the <code class="docutils literal notranslate"><span class="pre">/interfaces/</span></code> directory. See
the <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/master/interfaces/README.md">README</a> there for
details.</p>
</section>
<section id="testing-idl-fragments">
<h2>Testing IDL fragments<a class="headerlink" href="#testing-idl-fragments" title="Link to this heading">¶</a></h2>
<p>For example, the Fetch API’s IDL is tested in
<a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/master/fetch/api/idlharness.any.js"><code class="docutils literal notranslate"><span class="pre">/fetch/api/idlharness.any.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// META: global=window,worker</span>
<span class="c1">// META: script=/resources/WebIDLParser.js</span>
<span class="c1">// META: script=/resources/idlharness.js</span>
<span class="c1">// META: timeout=long</span>

<span class="nx">idl_test</span><span class="p">(</span>
<span class="w">  </span><span class="p">[</span><span class="s1">&#39;fetch&#39;</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s1">&#39;referrer-policy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;html&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dom&#39;</span><span class="p">],</span>
<span class="w">  </span><span class="nx">idl_array</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">idl_array</span><span class="p">.</span><span class="nx">add_objects</span><span class="p">({</span>
<span class="w">      </span><span class="nx">Headers</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;new Headers()&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nx">Request</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;new Request(&#39;about:blank&#39;)&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nx">Response</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;new Response()&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">GLOBAL</span><span class="p">.</span><span class="nx">isWindow</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">idl_array</span><span class="p">.</span><span class="nx">add_objects</span><span class="p">({</span><span class="w"> </span><span class="nx">Window</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">GLOBAL</span><span class="p">.</span><span class="nx">isWorker</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">idl_array</span><span class="p">.</span><span class="nx">add_objects</span><span class="p">({</span><span class="w"> </span><span class="nx">WorkerGlobalScope</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Note how it includes <code class="docutils literal notranslate"><span class="pre">/resources/WebIDLParser.js</span></code> and <code class="docutils literal notranslate"><span class="pre">/resources/idlharness.js</span></code> in addition to
<code class="docutils literal notranslate"><span class="pre">testharness.js</span></code> and <code class="docutils literal notranslate"><span class="pre">testharnessreport.js</span></code> (automatically included due to usage of <code class="docutils literal notranslate"><span class="pre">.any.js</span></code>).
These are needed to make the <code class="docutils literal notranslate"><span class="pre">idl_test</span></code> function work.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">idl_test</span></code> function takes three arguments:</p>
<ul class="simple">
<li><p><em>srcs</em>: a list of specifications whose IDL you want to test. The names here need to match the filenames (excluding the extension) in <code class="docutils literal notranslate"><span class="pre">/interfaces/</span></code>.</p></li>
<li><p><em>deps</em>: a list of specifications the IDL listed in <em>srcs</em> depends upon. Be careful to list them in the order that the dependencies are revealed.</p></li>
<li><p><em>setup_func</em>: a function or async function that takes care of creating the various objects that you want to test.</p></li>
</ul>
</section>
<section id="methods-of-idlarray">
<h2>Methods of <code class="docutils literal notranslate"><span class="pre">IdlArray</span></code><a class="headerlink" href="#methods-of-idlarray" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">IdlArray</span></code> objects can be obtained through the <em>setup_func</em> argument of <code class="docutils literal notranslate"><span class="pre">idl_test</span></code>. Anything not
documented in this section should be considered an implementation detail, and outside callers should
not use it.</p>
<section id="add-objects-dict">
<h3><code class="docutils literal notranslate"><span class="pre">add_objects(dict)</span></code><a class="headerlink" href="#add-objects-dict" title="Link to this heading">¶</a></h3>
<p><em>dict</em> should be an object whose keys are the names of interfaces or exceptions, and whose values
are arrays of strings.  When an interface or exception is tested, every string registered for it
with <code class="docutils literal notranslate"><span class="pre">add_objects()</span></code> will be evaluated, and tests will be run on the result to verify that it
correctly implements that interface or exception.  This is the only way to test anything about
<code class="docutils literal notranslate"><span class="pre">[LegacyNoInterfaceObject]</span></code> interfaces, and there are many tests that can’t be run on any interface
without an object to fiddle with.</p>
<p>The interface has to be the <em>primary</em> interface of all the objects provided.  For example, don’t
pass <code class="docutils literal notranslate"><span class="pre">{Node:</span> <span class="pre">[&quot;document&quot;]}</span></code>, but rather <code class="docutils literal notranslate"><span class="pre">{Document:</span> <span class="pre">[&quot;document&quot;]}</span></code>.  Assuming the <code class="docutils literal notranslate"><span class="pre">Document</span></code>
interface was declared to inherit from <code class="docutils literal notranslate"><span class="pre">Node</span></code>, this will automatically test that document implements
the <code class="docutils literal notranslate"><span class="pre">Node</span></code> interface too.</p>
<p>Warning: methods will be called on any provided objects, in a manner that WebIDL requires be safe.
For instance, if a method has mandatory arguments, the test suite will try calling it with too few
arguments to see if it throws an exception. If an implementation incorrectly runs the function
instead of throwing, this might have side effects, possibly even preventing the test suite from
running correctly.</p>
</section>
<section id="prevent-multiple-testing-name">
<h3><code class="docutils literal notranslate"><span class="pre">prevent_multiple_testing(name)</span></code><a class="headerlink" href="#prevent-multiple-testing-name" title="Link to this heading">¶</a></h3>
<p>This is a niche method for use in case you’re testing many objects that implement the same
interfaces, and don’t want to retest the same interfaces every single time. For instance, HTML
defines many interfaces that all inherit from <code class="docutils literal notranslate"><span class="pre">HTMLElement</span></code>, so the HTML test suite has something
like</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">add_objects</span><span class="p">({</span>
<span class="w">  </span><span class="nx">HTMLHtmlElement</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;document.documentElement&#39;</span><span class="p">],</span>
<span class="w">  </span><span class="nx">HTMLHeadElement</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;document.head&#39;</span><span class="p">],</span>
<span class="w">  </span><span class="nx">HTMLBodyElement</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;document.body&#39;</span><span class="p">],</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">})</span>
</pre></div>
</div>
<p>and so on for dozens of element types.  This would mean that it would retest that each and every one
of those elements implements <code class="docutils literal notranslate"><span class="pre">HTMLElement</span></code>, <code class="docutils literal notranslate"><span class="pre">Element</span></code>, and <code class="docutils literal notranslate"><span class="pre">Node</span></code>, which would be thousands of
basically redundant tests. The test suite therefore calls <code class="docutils literal notranslate"><span class="pre">prevent_multiple_testing(&quot;HTMLElement&quot;)</span></code>.
This means that once one object has been tested to implement <code class="docutils literal notranslate"><span class="pre">HTMLElement</span></code> and its ancestors, no
other object will be.  Thus in the example code above, the harness would test that
<code class="docutils literal notranslate"><span class="pre">document.documentElement</span></code> correctly implements <code class="docutils literal notranslate"><span class="pre">HTMLHtmlElement</span></code>, <code class="docutils literal notranslate"><span class="pre">HTMLElement</span></code>, <code class="docutils literal notranslate"><span class="pre">Element</span></code>, and
<code class="docutils literal notranslate"><span class="pre">Node</span></code>; but <code class="docutils literal notranslate"><span class="pre">document.head</span></code> would only be tested for <code class="docutils literal notranslate"><span class="pre">HTMLHeadElement</span></code>, and so on for further
objects.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro-video-transcript.html">“Introduction to WPT” video transcript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running-tests/index.html">Running Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Writing Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#test-types">Test Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#submitting-tests">Submitting Tests</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Project Administration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Writing Tests</a><ul>
  <li><a href="testharness.html">JavaScript Tests (testharness.js)</a><ul>
      <li>Previous: <a href="testdriver-extension-tutorial.html" title="previous chapter">Testdriver extension tutorial</a></li>
      <li>Next: <a href="testharness-tutorial.html" title="next chapter">testharness.js tutorial</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, wpt contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/writing-tests/idlharness.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
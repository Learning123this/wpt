<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>wdspec tests &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Manual Tests" href="manual.html" />
    <link rel="prev" title="crashtest tests" href="crashtest.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="wdspec-tests">
<h1>wdspec tests<a class="headerlink" href="#wdspec-tests" title="Link to this heading">¶</a></h1>
<p>The term “wdspec” describes a type of test in WPT which verifies some aspect of
<a class="reference external" href="https://w3c.github.io/webdriver/">WebDriver Classic</a> or
<a class="reference external" href="https://w3c.github.io/webdriver-bidi">WebDriver BiDi</a> protocols. These tests are
written in <a class="reference external" href="https://www.python.org/">the Python programming language</a> and
structured with <a class="reference external" href="https://docs.pytest.org/en/latest/">the pytest testing
framework</a>.</p>
<p>The test files are organized into subdirectories based on the WebDriver
command under test. For example, tests for <a class="reference external" href="https://w3c.github.io/webdriver/#close-window">the Close Window
command</a> are located in then
<code class="docutils literal notranslate"><span class="pre">close_window</span></code> directory.</p>
<p>Similar to <a class="reference internal" href="testharness.html"><span class="doc">testharness.js</span></a> tests, wdspec tests contain within
them any number of “sub-tests.” Sub-tests are defined as Python functions whose
name begins with <code class="docutils literal notranslate"><span class="pre">test_</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">test_stale_element</span></code>.</p>
<section id="the-webdriver-client-library">
<h2>The <code class="docutils literal notranslate"><span class="pre">webdriver</span></code> client library<a class="headerlink" href="#the-webdriver-client-library" title="Link to this heading">¶</a></h2>
<p>web-platform-tests maintains a WebDriver client library called <code class="docutils literal notranslate"><span class="pre">webdriver</span></code>
located in the <code class="docutils literal notranslate"><span class="pre">tools/webdriver/</span></code> directory. Like other client libraries, it
makes it easier to write code which interfaces with a browser using the
protocol.</p>
<p>Many tests require some “set up” code–logic intended to bring the browser to a
known state from which the expected behavior can be verified. The convenience
methods in the <code class="docutils literal notranslate"><span class="pre">webdriver</span></code> library <strong>should</strong> be used to perform this task
because they reduce duplication.</p>
<p>However, the same methods <strong>should not</strong> be used to issue the command under
test. Instead, the HTTP request describing the command should be sent directly.
This practice promotes the descriptive quality of the tests and limits
indirection that tends to obfuscate test failures.</p>
<p>Here is an example of a test for <a class="reference external" href="https://w3c.github.io/webdriver/#element-click">the Element Click
command</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tests.support.asserts</span><span class="w"> </span><span class="kn">import</span> <span class="n">assert_success</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_null_response_value</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">inline</span><span class="p">):</span>
    <span class="c1"># The high-level API is used to set up a document and locate a click target</span>
    <span class="n">session</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">inline</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;foo&quot;</span><span class="p">)</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># An HTTP request is explicitly constructed for the &quot;click&quot; command itself</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
        <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;session/</span><span class="si">{session_id}</span><span class="s2">/element/</span><span class="si">{element_id}</span><span class="s2">/click&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">element_id</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="n">assert_success</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="utility-functions">
<h2>Utility functions<a class="headerlink" href="#utility-functions" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">wedbdriver</span></code> library is minimal by design. It mimics the structure of the
WebDriver specification. Many conformance tests perform similar operations
(e.g. calculating the center point of an element or creating a document), but
the library does not expose methods to facilitate them. Instead, wdspec tests
define shared functionality in the form of “support” files.</p>
<p>Many of these functions are intended to be used directly from the tests using
Python’s built-in <code class="docutils literal notranslate"><span class="pre">import</span></code> keyword. Others (particularly those that operate on
a WebDriver session) are defined in terms of Pytest “fixtures” and must be
loaded accordingly. For more detail on how to define and use test fixtures,
please refer to <a class="reference external" href="https://docs.pytest.org/en/latest/fixture.html">the pytest project’s documentation on the
topic</a>.</p>
</section>
<section id="webdriver-bidi">
<h2>WebDriver BiDi<a class="headerlink" href="#webdriver-bidi" title="Link to this heading">¶</a></h2>
<p>The wdspec tests for <a class="reference external" href="https://w3c.github.io/webdriver-bidi">WebDriver BiDi</a> are
located in the <code class="docutils literal notranslate"><span class="pre">tests/bidi/</span></code> and <code class="docutils literal notranslate"><span class="pre">tests/interop</span></code> directories. Tests related to
external specifications are located in <code class="docutils literal notranslate"><span class="pre">external</span></code> subdirectories e.g.
<a class="reference external" href="https://www.w3.org/TR/permissions/">Permissions</a> tests would go in
<code class="docutils literal notranslate"><span class="pre">tests/bidi/external/permissions/</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">webdriver.bidi.client.BidiSession</span></code> class provides an abstraction for the BiDi
client and contains properties corresponding to the
<a class="reference external" href="https://w3c.github.io/webdriver-bidi/#protocol-modules">WebDriver BiDi modules</a>. It
can be retrieved by fixture <code class="docutils literal notranslate"><span class="pre">bidi_session</span></code>.</p>
<section id="extending-webdriver-bidi">
<h3>Extending WebDriver BiDi<a class="headerlink" href="#extending-webdriver-bidi" title="Link to this heading">¶</a></h3>
<p>This section describes how to extend the WebDriver BiDi client with an example of
adding support for <a class="reference external" href="https://www.w3.org/TR/permissions/">Permissions</a>.</p>
<section id="adding-a-new-module">
<h4>Adding a New Module<a class="headerlink" href="#adding-a-new-module" title="Link to this heading">¶</a></h4>
<section id="create-bidimodule">
<h5>Create <code class="docutils literal notranslate"><span class="pre">BidiModule</span></code><a class="headerlink" href="#create-bidimodule" title="Link to this heading">¶</a></h5>
<p>BiDi modules are defined in the <code class="docutils literal notranslate"><span class="pre">tools/webdriver/webdriver/bidi/modules/</span></code> directory.
To add a new module called <code class="docutils literal notranslate"><span class="pre">permissions</span></code>, declare a Python class
<code class="docutils literal notranslate"><span class="pre">webdriver.bidi.modules.permissions.Permissions</span></code> that inherits from <code class="docutils literal notranslate"><span class="pre">BidiModule</span></code> and
store it in <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/b81831169b8527a6c569a4ad92cf8a1baf4a7118/tools/webdriver/webdriver/bidi/modules/permissions.py#L7"><code class="docutils literal notranslate"><span class="pre">tools/webdriver/webdriver/bidi/modules/permissions.py</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Permissions</span><span class="p">(</span><span class="n">BidiModule</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="import-the-module-in-bidi-modules-init-py">
<h5>Import the Module in <code class="docutils literal notranslate"><span class="pre">bidi/modules/__init__.py</span></code><a class="headerlink" href="#import-the-module-in-bidi-modules-init-py" title="Link to this heading">¶</a></h5>
<p>Import this class in <code class="docutils literal notranslate"><span class="pre">tools/webdriver/webdriver/bidi/modules/__init__.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Permissions</span>
</pre></div>
</div>
</section>
<section id="create-an-instance-of-the-module-in-webdriver-bidi-client-bidisession">
<h5>Create an Instance of the Module in <code class="docutils literal notranslate"><span class="pre">webdriver.bidi.client.BidiSession</span></code><a class="headerlink" href="#create-an-instance-of-the-module-in-webdriver-bidi-client-bidisession" title="Link to this heading">¶</a></h5>
<p>Modify the <code class="docutils literal notranslate"><span class="pre">webdriver.bidi.client.BidiSession.__init__</span></code> method to create an instance
of <code class="docutils literal notranslate"><span class="pre">Permissions</span></code> and store it in a <code class="docutils literal notranslate"><span class="pre">permissions</span></code> <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/b81831169b8527a6c569a4ad92cf8a1baf4a7118/tools/webdriver/webdriver/bidi/client.py#L98">property</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">permissions</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">Permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="adding-a-new-command">
<h4>Adding a New Command<a class="headerlink" href="#adding-a-new-command" title="Link to this heading">¶</a></h4>
<p><a class="reference external" href="https://w3c.github.io/webdriver-bidi/#commands">WebDriver BiDi commands</a> are
represented as module methods decorated with
<code class="docutils literal notranslate"><span class="pre">&#64;command</span></code> (<code class="docutils literal notranslate"><span class="pre">webdriver.bidi.modules._module.command</span></code>). To add a new command, add
a method with the corresponding name (translated from camel case to snake case) to
the module. The method should return a dictionary that represents the
<a class="reference external" href="https://w3c.github.io/webdriver-bidi/#command-command-parameters">command parameters</a>.</p>
<p>For example, to add the
<a class="reference external" href="https://www.w3.org/TR/permissions/#webdriver-bidi-command-permissions-setPermission"><code class="docutils literal notranslate"><span class="pre">permissions.setPermission</span></code></a>
command, add the following <code class="docutils literal notranslate"><span class="pre">set_permission</span></code> method to the <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/b81831169b8527a6c569a4ad92cf8a1baf4a7118/tools/webdriver/webdriver/bidi/modules/permissions.py#L9"><code class="docutils literal notranslate"><span class="pre">Permissions</span></code> class</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">._module</span><span class="w"> </span><span class="kn">import</span> <span class="n">command</span>
<span class="o">...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Permissions</span><span class="p">(</span><span class="n">BidiModule</span><span class="p">):</span>
<span class="o">...</span>
    <span class="nd">@command</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
          <span class="n">descriptor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Undefined</span><span class="p">]</span> <span class="o">=</span> <span class="n">UNDEFINED</span><span class="p">,</span>
          <span class="n">state</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Undefined</span><span class="p">]</span> <span class="o">=</span> <span class="n">UNDEFINED</span><span class="p">,</span>
          <span class="n">origin</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Undefined</span><span class="p">]</span> <span class="o">=</span> <span class="n">UNDEFINED</span><span class="p">,</span>
          <span class="n">user_context</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Undefined</span><span class="p">]</span> <span class="o">=</span> <span class="n">UNDEFINED</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;descriptor&quot;</span><span class="p">:</span> <span class="n">descriptor</span><span class="p">,</span>
            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span>
            <span class="s2">&quot;userContext&quot;</span><span class="p">:</span> <span class="n">user_context</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">params</span>
</pre></div>
</div>
</section>
</section>
<section id="adding-tests">
<h3>Adding Tests<a class="headerlink" href="#adding-tests" title="Link to this heading">¶</a></h3>
<p>Generally, a single test file should contain tests for a single parameter or feature
and stored in <code class="docutils literal notranslate"><span class="pre">webdriver/tests/bidi/{MODULE}/{METHOD}/{FEATURE}.py</span></code>
For example, tests for
<a class="reference external" href="https://www.w3.org/TR/permissions/#webdriver-bidi-command-permissions-setPermission"><code class="docutils literal notranslate"><span class="pre">permissions.setPermission</span></code></a>
could be split into:</p>
<ul class="simple">
<li><p>Invalid parameters: <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/aa019e3ff08cc75644edca41cfb095601477cb9d/webdriver/tests/bidi/external/permissions/set_permission/invalid.py"><code class="docutils literal notranslate"><span class="pre">set_permission/invalid.py</span></code></a></p></li>
<li><p>Common scenarios: <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/aa019e3ff08cc75644edca41cfb095601477cb9d/webdriver/tests/bidi/external/permissions/set_permission/set_permission.py"><code class="docutils literal notranslate"><span class="pre">set_permission/set_permission.py</span></code></a></p></li>
<li><p>User context: <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/master/webdriver/tests/bidi/external/permissions/set_permission/user_context.py"><code class="docutils literal notranslate"><span class="pre">set_permission/user_context.py</span></code></a></p></li>
</ul>
<p>Tests should use <code class="docutils literal notranslate"><span class="pre">bidi_session</span></code>’s modules’ methods to send commands and verify its
side effects.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro-video-transcript.html">“Introduction to WPT” video transcript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running-tests/index.html">Running Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Writing Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#test-types">Test Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#submitting-tests">Submitting Tests</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Project Administration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Writing Tests</a><ul>
      <li>Previous: <a href="crashtest.html" title="previous chapter">crashtest tests</a></li>
      <li>Next: <a href="manual.html" title="next chapter">Manual Tests</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, wpt contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/writing-tests/wdspec.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>